package com.es.api_ciervus.service;

import com.es.api_ciervus.dto.ReservaDTO;
import com.es.api_ciervus.error.exception.BadRequestException;
import com.es.api_ciervus.error.exception.ResourceNotFoundException;
import com.es.api_ciervus.model.Producto;
import com.es.api_ciervus.model.Reserva;
import com.es.api_ciervus.model.Usuario;
import com.es.api_ciervus.repository.ProductoRepository;
import com.es.api_ciervus.repository.ReservaRepository;
import com.es.api_ciervus.repository.UsuarioRepository;
import com.es.api_ciervus.utils.Mapper;
import com.es.api_ciervus.utils.StringToLong;
import com.es.api_ciervus.utils.Validator;
import org.hibernate.annotations.NotFound;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class ReservaService {

    @Autowired
    private ReservaRepository reservaRepository;

    @Autowired
    private UsuarioRepository usuarioRepository;

    @Autowired
    private ProductoRepository productoRepository;

    @Autowired
    private Mapper mapper;

    public ReservaDTO create(ReservaDTO reservaDTO) {
        if (reservaDTO == null) {
            throw new BadRequestException("La reserva no puede estar vacia");
        }
        Usuario usuario = usuarioRepository.findById(reservaDTO.getUsuario_id()).orElseThrow(() -> new ResourceNotFoundException("El usuario no existe"));
        Producto producto = productoRepository.findById(reservaDTO.getProducto_id()).orElseThrow(() -> new ResourceNotFoundException("El producto no existe"));
        Validator.validateReserva(reservaDTO);
        Reserva reserva = mapper.mapToReserva(reservaDTO, usuario, producto);
        reservaRepository.save(reserva);
        return mapper.mapToReservaDTO(reserva);

    }

    public ReservaDTO getById(String id) {
        Long idLong = StringToLong.stringToLong(id);
    }

}
